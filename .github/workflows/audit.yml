name: Security audit

permissions:
    contents: read
on:
    schedule:
        # Runs at 00:00 UTC everyday
        - cron: "0 0 * * *"
    push:
        paths:
            - "**/Cargo.toml"
            - "**/Cargo.lock"
concurrency:
    group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
    cancel-in-progress: true
jobs:
    security_audit:
        runs-on: ubuntu-latest
        name: rustsec
        permissions:
            issues: write # to open issues for detected vulns
            checks: write # to create checks for detected vulns
        steps:
            - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # tag=v6.0.0
              with:
                  submodules: true
                  persist-credentials: false
            - uses: rustsec/audit-check@69366f33c96575abad1ee0dba8212993eecbe998 # tag=v2.0.0
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
